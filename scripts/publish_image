#!/bin/bash

# set readable variables
export JAVA_VERSION_ARG="$1"
export NODE_VERSION_ARG="$2"
export MBT_VERSION="$3"
export DOCKER_REGISTRY="$4"

# print parameters
echo "Java version arg: ${JAVA_VERSION_ARG}, Node version arg: ${NODE_VERSION_ARG}, \
MBT Version arg: ${MBT_VERSION}, Docker Registry arg: ${DOCKER_REGISTRY}"

# common_image includes some exported vars and check methods
source $PWD/scripts/common_image

# publish image
echo "Publish mbtci${JAVA_VERSION}${NODE_VERSION}:${MBT_VERSION} to $DOCKER_REGISTRY"

docker tag mbtci${JAVA_VERSION}${NODE_VERSION}:${MBT_VERSION} ${DOCKER_REGISTRY}/mbtci${JAVA_VERSION}${NODE_VERSION}:${MBT_VERSION}
docker push ${DOCKER_REGISTRY}/mbtci${JAVA_VERSION}${NODE_VERSION}:${MBT_VERSION}
docker tag mbtci${JAVA_VERSION}${NODE_VERSION}:${MBT_VERSION} ${DOCKER_REGISTRY}/mbtci${JAVA_VERSION}${NODE_VERSION}:latest
docker push ${DOCKER_REGISTRY}/mbtci${JAVA_VERSION}${NODE_VERSION}:latest

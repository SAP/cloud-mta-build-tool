'use strict';

var _ = require('lodash');
var util = require('util');

exports.isGloballyDisabled = function () {
  return /^none$/i.test(process.env.XS_APP_LOG_LEVEL);
};

exports.genericIsEnabled = function (level, availableLevels, currentLevel) {
  if (exports.isGloballyDisabled()) {
    return false;
  }
  if (!_.isString(level)) {
    return false;
  }
  level = level.toLowerCase();
  if (!_.isNumber(availableLevels[level])) {
    return false;
  }
  var iLevel = availableLevels[level];
  var iCurrentLevel = availableLevels[currentLevel];
  return (iCurrentLevel <= iLevel);
};

exports.isError = function (err) {
  return err && typeof err === 'object' && 'stack' in err && 'message' in err;
};

exports.createMessage = function (arrArgs) {
  for (var i in arrArgs) {
    if (exports.isError(arrArgs[i])) {
      arrArgs[i] = '[Error: ' + arrArgs[i].message + ']';
    } else if (_.isDate(arrArgs[i])) {
      arrArgs[i] = arrArgs[i].toISOString();
    }
  }
  return util.format.apply(null, arrArgs);
};

'use strict';

module.exports = function secureCookie(req, res, next) {
  if (!isConnectionEncrypted(req)) {
    var err = new Error('Secure flag on session cookie is enforced but the request is sent over unencrypted connection.');
    err.status = 403;
    return next(err);
  }
  next();
};

function isConnectionEncrypted(req) {
  if (req.connection.encrypted) {
    return true;
  }
  if (req.headers['x-forwarded-proto'] === 'https') {
    return true;
  }
  return false;
}

'use strict';

var sessionCookieProvider = require('./session-cookie-provider');
var stripClientCookies = require('./strip-client-cookies');

module.exports = function sessionCookieMiddleware(sessionCookieName) {
  return function (req, res, next) {
    if (!req.session || !req.internalUrl) {
      return next();
    }
    stripClientCookies(req, sessionCookieName);
    sessionCookieProvider(req, function (err, cookies) {
      if (err) {
        return next(err);
      }
      if (cookies) {
        req.headers.cookie = req.headers.cookie ? req.headers.cookie + '; ' + cookies : cookies;
      }
      next();
    });
  };
};
